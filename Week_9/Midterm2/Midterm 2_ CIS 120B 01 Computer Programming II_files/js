var evalkit_setup = { auth_external_tool_id: 4691, account_url: 'https://ltcc.evaluationkit.com', account_id: 1 };var evalkit_loaded=0,evalkit_isChrome=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),evalkit_issafari=evalkit_isChrome||-1!==navigator.userAgent.indexOf("Safari")&&(-1===navigator.userAgent.indexOf("Chrome")||-1<navigator.userAgent.indexOf("Chrome")&&-1<navigator.userAgent.indexOf("OPR")),EvaluationKIT={onLoad:function(){if(this.setInitCookie(!0),!(null===ENV.current_user_id||-1<window.location.href.indexOf("sessionless_launch")||0===$("#dashboard").length&&0===$(".context_external_tool_"+evalkit_setup.auth_external_tool_id).length&&0===this.getPageCourseId()&&-1===document.location.href.indexOf("/profile")&&-1===document.location.href.indexOf("/grades")||3<(evalkit_loaded+=1))){var e=this.getTokenCookie(),t=this.getVerifyCookie();0===e.length||t!==ENV.current_user_id?this.onLti():this.onUser(e)}},onLti:function(){this.startInit(function(){(EvaluationKIT||{}).onAuth()})},startInit:function(n){var o=this,e=o.getInitCookie();null!==e&&!1===e||(null===e||!0!==e?$.get("/api/v1/users/self/profile",function(t){if(0<t.login_id.length){var e=o.getPageCourseId();0<e?$.get("/api/v1/courses/"+e,function(e){0<e.id?o.onAuthInit(t.id,t.login_id,t.integration_id,e.id,e.course_code,n):o.setInitCookie(!1)}):o.onAuthInit(t.id,t.login_id,t.integration_id,0,"",n)}else o.setInitCookie(!1)}):n())},onAuthInit:function(e,t,n,o,i,a){var l=this;$.get(evalkit_setup.account_url+"/Canvas/InitCheck?authId="+evalkit_setup.auth_external_tool_id+"&username="+encodeURIComponent(t)+"&userid="+e+"&integration_id="+encodeURIComponent(n)+"&coursecode="+encodeURIComponent(i)+"&courseid="+o+"&refer="+encodeURIComponent(window.location.pathname+window.location.search)+"&nocache="+(new Date).getTime(),function(e){l.setInitCookie(e.result),!1!==e.result&&a()})},onAuth:function(){var t=this.createCORSRequest("GET","/api/v1/accounts/"+evalkit_setup.account_id+"/external_tools/sessionless_launch?id="+evalkit_setup.auth_external_tool_id+"&url="+encodeURIComponent(evalkit_setup.account_url+"/Canvas/Lti"));t&&(t.onload=function(){if(200===t.status){var e=$.parseJSON(t.responseText.replace("while(1);",""));0<$("#evalkit-lti").length&&$("#evalkit-lti").remove(),$('<iframe src="'+e.url+'" id="evalkit-lti" style="display:none;"></iframe>').appendTo($("body"))}else{(EvaluationKIT||{}).onLoad()}},t.send())},onLtiResponse:function(e){if(null!==e.origin&&-1!==e.origin.toLowerCase().indexOf(evalkit_setup.account_url)&&null!==e.data&&void 0!==e.data.length){var t=EvaluationKIT||{},n=JSON.parse(e.data);if(null!==n)switch(n.subject){case"evalkit.location":window.top.location.href=n.url;break;case"evalkit.ltiresponse":var o=n.token;0===o.length&&(o="-1"),t.setTokenCookie(o),t.setVerifyCookie(ENV.current_user_id),t.onLoad()}else console.log("DEBUG: onLtiResponse - jsondata error")}},onUser:function(o){"-1"!==o&&this.startInit(function(){var e=EvaluationKIT||{},n=e.getPageCourseId();if(null===document.getElementById("ek_css")){var t=document.createElement("link");t.setAttribute("id","ek_css"),t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",evalkit_setup.account_url+"/scripts/canvas/style.min.css"),document.getElementsByTagName("head")[0].appendChild(t)}0===n?e.getUserSettings(o,n,""):$.ajax({url:"/api/v1/courses/"+n,type:"GET",success:function(e){var t="";try{t=e.course_code}catch(e){(EvaluationKIT||{}).onError(e)}(EvaluationKIT||{}).getUserSettings(o,n,t)},error:function(e){var t=EvaluationKIT||{};t.onError(e),t.onLoad()}})})},getUserSettings:function(e,n,t){var o=this.createCORSRequest("GET",evalkit_setup.account_url+"/canvas/usersettings?token="+encodeURIComponent(e)+"&userid="+ENV.current_user_id+(0<n?"&courseid="+n+"&coursecode="+encodeURIComponent(t)+"&courseTitle=":"")+"&refer="+encodeURIComponent(window.location.pathname+window.location.search)+"&isSafari="+evalkit_issafari+"&nocache="+(new Date).getTime());o&&(o.onload=function(){if(401===o.status)(EvaluationKIT||{}).onLti();else try{var e=$.parseJSON(o.responseText),t=EvaluationKIT||{};t.onPopup(e),t.onWidget(e),t.onLinks(e,n),$(document).on("click",".ek-sessionless",function(e){var t=$(this).attr("href");evalkit_issafari?t=$(this).data("safariurl"):e.preventDefault();var n=(EvaluationKIT||{}).createCORSRequest("GET",t);n&&(n.onload=function(){if(200===n.status){var e=$.parseJSON(n.responseText.replace("while(1);",""));if(void 0!==e.url&&null!==e&&0<e.url.length)ek_modal.open({iframelink:e.url,buttons:null,iframeheight:800,cssclass:"evalkit-modal-lg",showClose:!0,type:"notification"});else(EvaluationKIT||{}).onLti()}else{(EvaluationKIT||{}).onLti()}},n.send())})}catch(e){(EvaluationKIT||{}).onError(e)}},o.onerror=function(e){var t=EvaluationKIT||{};-1<navigator.appVersion.indexOf("MSIE 10")||-1<navigator.appVersion.indexOf("MSIE 9")?t.onLti():t.onError(e)},o.send())},onPopup:function(n){if(!0===n.popup.visible){var e=[],t=document.createElement("a");if(t.innerHTML=n.popup.gotosurveytext,-1<n.popup.gotosurveyurl.indexOf("sessionless_launch")?(t.setAttribute("class","Button Button--primary ek-widget-btn-primary ek-sessionless"),evalkit_issafari?(t.setAttribute("href",evalkit_setup.account_url+"/MyEval/CookieSet.aspx"),t.setAttribute("data-safariurl",n.popup.gotosurveyurl),t.setAttribute("target","_blank")):t.setAttribute("href",n.popup.gotosurveyurl)):(t.setAttribute("class","Button Button--primary ek-widget-btn-primary"),t.setAttribute("href",n.popup.gotosurveyurl)),e[0]=t,n.popup.remindlater){var o=document.createElement("a");o.innerHTML=n.popup.remindlatertext,o.setAttribute("href","#"),o.setAttribute("class","Button ek-widget-btn-default"),!0===n.popup.incrementDefer?o.onclick=function(e){e.preventDefault(),ek_modal.close();var t=EvaluationKIT||{};$.get(evalkit_setup.account_url+"/canvas/defer?token="+encodeURIComponent(t.getTokenCookie())+"&projectId="+n.popup.projectId+"&courseId="+n.popup.courseId+"&nocache="+(new Date).getTime())}:o.onclick=function(e){e.preventDefault(),ek_modal.close()},e[1]=o}ek_modal.open({title:n.popup.header,body:n.popup.body,buttons:e,showClose:!1,type:!0===n.popup.blockPage?"blocker":"notification"})}},onWidget:function(e){$(e.widget).appendTo("#right-side"),evalkit_issafari&&null!==e.widget&&$(".ek-widget a").each(function(e){var t=$(this);t.hasClass("ek-sessionless")&&(t.attr("data-safariurl",t.attr("href")),t.attr("href",evalkit_setup.account_url+"/MyEval/CookieSet.aspx"),t.attr("target","_blank"))})},onLinks:function(e,t){this.setLink(e.userlink,t),this.setLink(e.studentlink,t),this.setLink(e.instructorlink,t),this.setLink(e.talink,t),this.setLink(e.adminlink,t)},createCORSRequest:function(e,t){try{var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest).open(e,t):n=null,n}catch(e){this.onError(e)}},getPageCourseId:function(){return void 0!==$("body").attr("class")&&$("body").attr("class").match(/\bcontext-course_(.[0-9]*)/)?parseInt($("body").attr("class").match(/\bcontext-course_(.[0-9]*)/)[1]):0},getPageUserId:function(){return $("body").attr("class").match(/\bcontext-user_(.[0-9]*)/)?$("body").attr("class").match(/\bcontext-user_(.[0-9]*)/)[1]:""},getTokenCookie:function(){return evalkit_readCookie("evalkit_token_"+evalkit_setup.auth_external_tool_id)||""},setTokenCookie:function(e){evalkit_createCookie("evalkit_token_"+evalkit_setup.auth_external_tool_id,e)},getVerifyCookie:function(){return evalkit_readCookie("evalkit_verify_"+evalkit_setup.auth_external_tool_id)||""},setVerifyCookie:function(e){evalkit_createCookie("evalkit_verify_"+evalkit_setup.auth_external_tool_id,e)},getInitCookie:function(){var e=evalkit_readCookie("evalkit_init_verfiy_"+evalkit_setup.auth_external_tool_id);if(null!==e&&""!==e||(e=-1),-1!==e&&e!==ENV.current_user_id)return evalkit_createCookie("evalkit_init_verfiy_"+evalkit_setup.auth_external_tool_id,ENV.current_user_id),evalkit_createCookie("evalkit_init_"+evalkit_setup.auth_external_tool_id,""),null;var t=evalkit_readCookie("evalkit_init_"+evalkit_setup.auth_external_tool_id);if(null===t||""===t)return null;var n=this.getSection();if(null===n)return!1;for(var o=JSON.parse(t),i=0;i<o.length;i++)if(o[i].section===n)return o[i].val;return null},setInitCookie:function(e){var t=evalkit_readCookie("evalkit_init_"+evalkit_setup.auth_external_tool_id);null!==t&&""!==t||(t="");var n=this.getSection();if(null!==n){for(var o=0===t.length?[]:JSON.parse(t),i=!1,a=0;a<o.length;a++)o[a].section===n&&(i=!0,o[a].val=e);!1===i&&o.push({section:n,val:e}),evalkit_createCookie("evalkit_init_verfiy_"+evalkit_setup.auth_external_tool_id,ENV.current_user_id),evalkit_createCookie("evalkit_init_"+evalkit_setup.auth_external_tool_id,JSON.stringify(o))}},getSection:function(){var e=null;return 0<$("#dashboard").length?e="dashboard":-1<document.location.href.indexOf("/profile")?e="profile":0<this.getPageCourseId()?e=this.getPageCourseId():-1<document.location.href.indexOf("/grades")&&(e="dashboard"),e},setLink:function(e){if(null!==e&&null!==e.url){var t=$("a.context_external_tool_"+e.exttoolid);e.visible?(0===t.length||t.hasClass("evalkit-ltilink")?($("<li class='section evalkitlink'><a style='display:block !important;' class='evalkit-ltilink ltilinkcontext_external_tool_"+e.exttoolid+"' href='"+e.url+"'>"+e.title+"</a></li>").appendTo("#section-tabs"),t=$("a.context_external_tool_"+e.exttoolid)):(t.attr("style","display: block !important;"),t.attr("href",e.url),e.title!==t.html()&&t.html(e.title)),null!==e.badge&&$('<b class="nav-badge evalkit-badge">'+e.badge+"</b>").prependTo(t),t.parent().show(),t.addClass("evalkit-ltilink")):t.hasClass("evalkit-ltilink")||t.parent().hide()}},onError:function(e){console.log("EvaluationKIT Canvas User Integration Error: "+e),console.log("EvaluationKIT Canvas User Integration Error Stack: "+e.stack)}};$(document).ready(function(){var e=EvaluationKIT||{};window.addEventListener?window.addEventListener("message",e.onLtiResponse,!1):window.attachEvent("onmessage",e.onLtiResponse),e.onLoad()});var ek_modal=function(){var o,i,a,l,r,s,e={};(o=document.createElement("div")).id="ek-overlay",o.style.display="none",(i=document.createElement("div")).id="ek-modal",i.style.display="none",i.setAttribute("role","dialog"),i.setAttribute("tabindex","-1"),i.setAttribute("aria-live","assertive"),i.setAttribute("aria-labelledby","ek-modal-header");var t=document.createElement("div");return t.setAttribute("class","ek-modal-content"),(a=document.createElement("h2")).setAttribute("class","ek-modal-header"),a.id="ek-modal-header",(s=document.createElement("a")).setAttribute("id","ek-modal-close"),(l=document.createElement("div")).setAttribute("class","ek-modal-body"),l.setAttribute("id","ek-modal-body"),(r=document.createElement("div")).setAttribute("class","ek-modal-footer"),t.appendChild(a),t.appendChild(s),t.appendChild(l),t.appendChild(r),i.appendChild(t),e.open=function(e){if(null!==e){if(void 0!==e.cssclass&&null!==e.cssclass&&i.setAttribute("class",e.cssclass),l.innerHTML="",void 0!==e.iframelink&&null!==e.iframelink&&0<e.iframelink.length?(l.innerHTML='<iframe id="ek-modal-iframe-loading"></iframe><iframe src='+e.iframelink+' id="ek-modal-iframe" style=\'display:none;\' onload="evalkit_modal_iframe();"></frame>',window.removeEventListener("resize",evalkit_modal_iframe_resize),window.addEventListener("resize",evalkit_modal_iframe_resize),evalkit_modal_iframe_resize(),document.getElementById("ek-modal-close").style.display="",document.getElementById("ek-modal-iframe-loading").contentWindow.document.write('<html><head></head><body style="text-align:center;"><img src="'+evalkit_setup.account_url+'/Media/Images/loadingd2l.gif" style="padding-top:10%;" /></body></html>')):l.innerHTML=e.body,void 0!==e.title&&null!==e.title?(a.innerHTML=e.title,a.style.display=""):a.style.display="none",o.setAttribute("class","ek-overlay-"+e.type),"blocker"===e.type){var t=window.getComputedStyle(document.getElementById("header"),null).getPropertyValue("background-color");0===t.length&&(t="rgb(57, 75, 88)"),o.style.background=t}else o.style.background="";if(i.setAttribute("oncontextmenu","return false"),o.setAttribute("oncontextmenu","return false"),o.style.display="",i.style.display="",i.setAttribute("data-type",e.type),window.scrollTo(0,0),$("body").addClass("ek-modal-open"),setTimeout(function(){$("body").removeClass("ek-modal-open")},2e3),void 0!==e.buttons&&null!==e.buttons&&0<e.buttons.length){r.innerHTML="";for(var n=0;n<e.buttons.length;n++)0===n&&e.buttons[n].focus(),r.appendChild(e.buttons[n]);r.style.display=""}else r.innerHTML="",r.style.display="none";!0!==e.showClose&&(s.style.display="none"),!0===e.refreshOnClose?s.onclick=function(e){$(document).keypress(function(e){if(27===e.keyCode)return e.preventDefault(),!1}),ek_modal.close(),document.location.href=document.location.href}:s.onclick=function(e){ek_modal.close()}}else console.log("ek_modalopen settings === null")},e.close=function(){$("body").removeClass("ek-modal-open"),o.style.display="none",i.style.display="none",l.innerHTML=""},document.body.appendChild(o),document.body.appendChild(i),e}();function evalkit_modal_iframe(e){var t=document.getElementById("ek-modal-iframe"),n=document.getElementById("ek-modal-iframe-loading");t.style.display="",n.style.display="none"}function evalkit_modal_iframe_resize(){var e=document.getElementById("ek-modal-iframe");null!==e&&e.setAttribute("height",window.innerHeight-180);var t=document.getElementById("ek-modal-iframe-loading");null!==t&&t.setAttribute("height",window.innerHeight-180)}function evalkit_createCookie(e,t){var n=new Date,o=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds());sessionStorage.setItem(e+"_E",o),sessionStorage.setItem(e,t)}function evalkit_readCookie(e){var t=sessionStorage.getItem(e+"_E");if(null===t)return sessionStorage.removeItem(e),null;var n=new Date;return 18e5<Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())-t?(sessionStorage.removeItem(e+"_E"),sessionStorage.removeItem(e),null):sessionStorage.getItem(e)}